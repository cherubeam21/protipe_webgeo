<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SISTEM INFORMASI PERTANAHAN 3D</title>

    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #00f3ff;
            --secondary: #ff0055;
            --bg-glass: rgba(10, 15, 20, 0.95);
        }

        body { margin: 0; padding: 0; background: #000; font-family: 'Rajdhani', sans-serif; overflow: hidden; color: white; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }

        /* LOADING */
        #loader {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999; display: flex; flex-direction: column;
            justify-content: center; align-items: center; transition: opacity 0.5s;
        }
        .spinner {
            width: 50px; height: 50px; border: 4px solid var(--primary);
            border-top: 4px solid transparent; border-radius: 50%;
            animation: putar 1s linear infinite;
        }
        @keyframes putar { to { transform: rotate(360deg); } }

        /* HEADER */
        .header-box {
            position: absolute; top: 20px; left: 20px;
            background: var(--bg-glass); padding: 15px 25px;
            border-left: 4px solid var(--primary); pointer-events: auto;
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.1); z-index: 50;
        }
        h1 { margin: 0; font-size: 22px; text-transform: uppercase; letter-spacing: 1px; }
        .subtitle { font-size: 11px; color: var(--primary); letter-spacing: 2px; font-weight: bold; }

        /* TOMBOL DOWNLOAD (BARU) */
        .download-wrapper {
            position: absolute; top: 95px; left: 20px; /* Posisi di bawah Header */
            z-index: 50; pointer-events: auto;
        }
        .btn-download {
            background: var(--bg-glass); border: 1px solid var(--primary);
            color: white; padding: 8px 15px; cursor: pointer;
            font-family: 'Rajdhani'; font-weight: bold; font-size: 12px;
            display: flex; align-items: center; gap: 8px;
            transition: 0.3s; letter-spacing: 1px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        .btn-download:hover {
            background: var(--primary); color: black;
            box-shadow: 0 0 15px var(--primary);
        }

        /* SEARCH */
        .search-wrapper {
            position: absolute; top: 20px; right: 20px;
            z-index: 50; pointer-events: auto;
        }
        .search-container {
            display: flex; gap: 5px;
            background: var(--bg-glass); padding: 10px; border-radius: 4px;
            border: 1px solid #333;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        #searchInput {
            background: rgba(0,0,0,0.5); border: 1px solid #444; color: white;
            padding: 8px; width: 220px; font-family: 'Rajdhani'; font-size: 14px;
        }
        #searchInput:focus { outline: 1px solid var(--primary); }
        .btn-search {
            background: var(--primary); color: black; border: none; padding: 0 15px;
            font-weight: bold; cursor: pointer; font-family: 'Rajdhani';
            transition: 0.3s;
        }
        .btn-search:hover { background: white; }

        /* LEGENDA */
        .legend-box {
            position: absolute; bottom: 120px; right: 20px;
            background: var(--bg-glass); padding: 15px;
            border-left: 4px solid var(--primary); border-radius: 4px;
            pointer-events: none; z-index: 40;
            min-width: 180px;
        }
        .legend-title { margin: 0 0 10px 0; font-size: 14px; text-transform: uppercase; color: var(--primary); font-weight: bold; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .legend-item { display: flex; align-items: center; margin-bottom: 6px; font-size: 12px; }
        .color-box { width: 16px; height: 16px; margin-right: 10px; border: 1px solid #555; display: inline-block; }

        /* KONTROL BAWAH */
        .controls {
