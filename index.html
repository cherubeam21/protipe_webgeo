<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TUGAS WEB GEOSPASIAL</title>
    
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #00f3ff; /* Cyan Neon */
            --bg-panel: rgba(0, 0, 0, 0.85);
            --border-color: rgba(0, 243, 255, 0.5);
        }

        body { margin: 0; padding: 0; overflow: hidden; background: #000; font-family: 'Rajdhani', sans-serif; color: var(--primary-color); }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; z-index: 0; }

        .hud-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 10;
            background: radial-gradient(circle at center, transparent 60%, rgba(0,0,0,0.4) 100%);
        }

        /* HEADER */
        .top-bar {
            position: absolute; top: 20px; left: 20px; right: 20px;
            display: flex; justify-content: space-between; align-items: flex-start;
            pointer-events: auto;
        }
        .title-box h1 { margin: 0; font-size: 28px; font-weight: 700; letter-spacing: 2px; text-shadow: 0 0 10px var(--primary-color); }
        .title-box span { font-size: 14px; opacity: 0.7; letter-spacing: 1px; }

        /* BASEMAP SELECTOR */
        .basemap-selector { display: flex; gap: 5px; background: var(--bg-panel); padding: 5px; border: 1px solid var(--border-color); border-radius: 4px; flex-wrap: wrap; justify-content: flex-end; max-width: 400px;}
        .map-btn {
            background: transparent; border: 1px solid transparent; color: rgba(255,255,255,0.7);
            padding: 5px 10px; cursor: pointer; font-family: 'Rajdhani'; font-weight: 600; transition: 0.2s; font-size: 12px;
        }
        .map-btn:hover, .map-btn.active { background: var(--primary-color); color: #000; box-shadow: 0 0 10px var(--primary-color); }

        /* BOTTOM PANEL */
        .bottom-panel {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            display: flex; align-items: center; gap: 20px; pointer-events: auto;
            background: var(--bg-panel); padding: 10px 30px;
            border: 1px solid var(--border-color); border-radius: 50px;
            backdrop-filter: blur(10px); box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
        }

        .mode-switch { display: flex; gap: 5px; }
        .icon-btn {
            background: rgba(255,255,255,0.1); border: 1px solid transparent; color: #fff; 
            width: 40px; height: 40px; border-radius: 50%; cursor: pointer; 
            font-family: 'Rajdhani'; font-weight: 700; transition: 0.3s;
            display: flex; align-items: center; justify-content: center; font-size: 18px;
        }
        .icon-btn:hover, .icon-btn.active { background: var(--primary-color); color: #000; box-shadow: 0 0 15px var(--primary-color); border-color: #fff; }

        /* STATS */
        .stat-group { text-align: center; min-width: 60px; }
        .stat-value { display: block; font-size: 18px; font-weight: 700; color: #fff; }
        .stat-label { font-size: 10px; opacity: 0.7; letter-spacing: 1px; }
        .divider { width: 1px; height: 30px; background: rgba(255,255,255,0.2); }

        /* DECORATION */
        .crosshair { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 40px; height: 40px; border: 1px solid rgba(0, 243, 255, 0.5); border-radius: 50%; pointer-events: none;}
        .crosshair::before { content: ''; position: absolute; top: 50%; left: -10px; width: 60px; height: 1px; background: var(--primary-color); }
        .crosshair::after { content: ''; position: absolute; left: 50%; top: -10px; height: 60px; width: 1px; background: var(--primary-color); }
        .corner { position: absolute; width: 20px; height: 20px; border: 2px solid var(--primary-color); opacity: 0.5; }
        .tl { top: 20px; left: 20px; border-right: none; border-bottom: none; }
        .tr { top: 20px; right: 20px; border-left: none; border-bottom: none; }
        .bl { bottom: 20px; left: 20px; border-right: none; border-top: none; }
        .br { bottom: 20px; right: 20px; border-left: none; border-top: none; }

        /* POPUP STYLING (INFO WINDOW) */
        .maplibregl-popup { max-width: 320px; font-family: 'Rajdhani', sans-serif; z-index: 50; }
        .maplibregl-popup-content {
            background: rgba(15, 20, 30, 0.95);
            border: 1px solid var(--primary-color);
            color: #fff; padding: 15px; border-radius: 4px;
            box-shadow: 0 0 25px rgba(0, 243, 255, 0.3);
        }
        .maplibregl-popup-close-button { color: var(--primary-color); font-size: 24px; right: 8px; top: 5px; }
        .maplibregl-popup-close-button:hover { background: none; color: #fff; }
        .maplibregl-popup-tip { border-top-color: var(--primary-color); }

        .popup-header { border-bottom: 1px solid var(--primary-color); margin-bottom: 10px; padding-bottom: 5px; }
        .popup-title { font-size: 16px; font-weight: 700; color: var(--primary-color); letter-spacing: 1px; }
        .popup-row { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 13px; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 2px;}
        .popup-label { opacity: 0.7; }
        .popup-val { font-weight: 600; text-align: right; color: #fff; }

    </style>
</head>
<body>

    <div id="map"></div>

    <div class="hud-container">
        <div class="corner tl"></div><div class="corner tr"></div><div class="corner bl"></div><div class="corner br"></div>

        <div class="top-bar">
            <div class="title-box">
                <h1>PROTOTIPE SISTEM INFORMASI SPASIAL BERBASIS WEB 2D/3D // <span style="color:#fff">MAJENE</span></h1>
                <span>LOCAL HOST/UNDEPLOYED</span>
            </div>
            <div class="basemap-selector">
                <button class="map-btn active" onclick="changeBasemap('dark', this)">DARK</button>
                <button class="map-btn" onclick="changeBasemap('google_street', this)">GOOGLE</button>
                <button class="map-btn" onclick="changeBasemap('google_hybrid', this)">HYBRID</button>
                <button class="map-btn" onclick="changeBasemap('satellite', this)">SAT</button>
            </div>
        </div>

        <div class="crosshair"></div>

        <div class="bottom-panel">
            <div class="mode-switch">
                <button class="icon-btn" id="btn2D" onclick="setMode('2D')">2D</button>
                <button class="icon-btn active" id="btn3D" onclick="setMode('3D')">3D</button>
            </div>
            <div class="divider"></div>
            <div class="stat-group">
                <span class="stat-value" id="zoom-level">15.0</span>
                <span class="stat-label">ZOOM</span>
            </div>
            <div class="divider"></div>
            <div class="stat-group">
                <span class="stat-value" id="pitch-level">60°</span>
                <span class="stat-label">TILT</span>
            </div>
        </div>
    </div>

    <script>
        // --- 1. KONFIGURASI STYLE MAP (DITAMBAH GOOGLE) ---
        const styles = {
            dark: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json',
            
            // PETA GOOGLE JALAN (Kuning/Putih)
            google_street: {
                'version': 8,
                'sources': {
                    'google-street': {
                        'type': 'raster',
                        'tiles': ['https://mt1.google.com/vt/lyrs=m&x={x}&y={y}&z={z}'], // m = Roadmap
                        'tileSize': 256
                    }
                },
                'layers': [{ 'id': 'google-layer', 'type': 'raster', 'source': 'google-street' }]
            },

            // PETA GOOGLE HYBRID (Satelit + Label Jalan)
            google_hybrid: {
                'version': 8,
                'sources': {
                    'google-hybrid': {
                        'type': 'raster',
                        'tiles': ['https://mt1.google.com/vt/lyrs=y&x={x}&y={y}&z={z}'], // y = Hybrid
                        'tileSize': 256
                    }
                },
                'layers': [{ 'id': 'google-layer', 'type': 'raster', 'source': 'google-hybrid' }]
            },

            // PETA SATELIT POLOS (ESRI)
            satellite: {
                'version': 8,
                'sources': {
                    'raster-tiles': {
                        'type': 'raster',
                        'tiles': ['https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'],
                        'tileSize': 256
                    }
                },
                'layers': [{ 'id': 'simple-tiles', 'type': 'raster', 'source': 'raster-tiles' }]
            }
        };

        var currentMode = '3D'; 

        // --- 2. INIT MAP ---
        var map = new maplibregl.Map({
            container: 'map',
            style: styles.dark,
            center: [118.973, -3.541],
            zoom: 15.5,
            pitch: 60,
            bearing: -20,
            antialias: true,
            dragRotate: true,
            pitchWithRotate: true,
            maxPitch: 85
        });

        map.addControl(new maplibregl.NavigationControl({ showCompass: true, showZoom: true, visualizePitch: true }), 'top-right');

        // --- 3. LOAD LAYERS (DATA) ---
        function loadCustomLayers() {
            // A. TERRAIN
            if (!map.getSource('terrain-source')) {
                try {
                    map.addSource('terrain-source', {
                        'type': 'raster-dem',
                        'tiles': ['https://s3.amazonaws.com/elevation-tiles-prod/terrarium/{z}/{x}/{y}.png'],
                        'encoding': 'terrarium',
                        'tileSize': 256,
                        'maxzoom': 15
                    });
                    map.setTerrain({ 'source': 'terrain-source', 'exaggeration': 1.0 });
                } catch (e) {}
            }

            // B. SKYBOX
            if (!map.getLayer('sky')) {
                try {
                    map.addLayer({
                        'id': 'sky', 'type': 'sky',
                        'paint': { 'sky-type': 'atmosphere', 'sky-atmosphere-sun': [0.0, 90.0], 'sky-atmosphere-sun-intensity': 15 }
                    });
                } catch (e) {}
            }

            // C. GEDUNG (GEOJSON)
            if (!map.getSource('bangunan-sumber')) {
                try {
                    map.addSource('bangunan-sumber', {
                        'type': 'geojson',
                        // PASTIKAN NAMA FILE BENAR:
                        'data': 'DATA/2D DUMMY.geojson' 
                    });

                    map.addLayer({
                        'id': 'bangunan-3d',
                        'type': 'fill-extrusion',
                        'source': 'bangunan-sumber',
                        'paint': {
                            'fill-extrusion-color': '#00f3ff', // Warna Cyan
                            'fill-extrusion-base': 0,
                            'fill-extrusion-opacity': 0.6, // Agak transparan biar jalan kelihatan
                            'fill-extrusion-height': 20
                        }
                    });
                    
                    updateBuildingHeight(currentMode);
                } catch (e) {}
            }
        }

        // --- 4. INTERAKSI POPUP ---
        map.on('click', 'bangunan-3d', function (e) {
            var props = e.features[0].properties;
            var coordinates = e.lngLat;

            // AMBIL DATA ATRIBUT (Sesuaikan dengan data GeoJSON Anda)
            var nama = props['name'] || props['nama'] || "Tanpa Nama";
            var tipe = props['type'] || props['building'] || "-";
            var tinggi = props['height'] || props['building:levels'] || "-";
            var id_objek = props['id'] || Math.floor(Math.random() * 1000); // Dummy ID

            // KONTEN POPUP HTML
            var content = `
                <div class="popup-header">
                    <div class="popup-title">INFORMASI OBJEK</div>
                </div>
                <div class="popup-row"><span class="popup-label">ID PERSIL:</span> <span class="popup-val">${id_objek}</span></div>
                <div class="popup-row"><span class="popup-label">TIPE HAK:</span> <span class="popup-val">${tipe}</span></div>
                <div class="popup-row"><span class="popup-label">PENGGUNAAN:</span> <span class="popup-val">${nama}</span></div>
                <div class="popup-row"><span class="popup-label">TINGGI:</span> <span class="popup-val">${tinggi}</span></div>
            `;

            new maplibregl.Popup()
                .setLngLat(coordinates)
                .setHTML(content)
                .addTo(map);
        });

        // Kursor berubah saat hover gedung
        map.on('mouseenter', 'bangunan-3d', function () { map.getCanvas().style.cursor = 'pointer'; });
        map.on('mouseleave', 'bangunan-3d', function () { map.getCanvas().style.cursor = ''; });

        // --- 5. LOGIKA FUNGSI ---
        function updateBuildingHeight(mode) {
            if (map.getLayer('bangunan-3d')) {
                map.setPaintProperty('bangunan-3d', 'fill-extrusion-height', mode === '2D' ? 0 : 20);
            }
        }

        map.on('load', loadCustomLayers);
        map.on('styledata', loadCustomLayers);
        
        map.on('move', function() {
            document.getElementById('zoom-level').innerText = map.getZoom().toFixed(1);
            document.getElementById('pitch-level').innerText = Math.round(map.getPitch()) + '°';
        });

        function changeBasemap(styleKey, btnElement) {
            map.setStyle(styles[styleKey]);
            document.querySelectorAll('.map-btn').forEach(b => b.classList.remove('active'));
            btnElement.classList.add('active');
        }

        function setMode(mode) {
            currentMode = mode;
            document.getElementById('btn2D').classList.remove('active');
            document.getElementById('btn3D').classList.remove('active');
            document.getElementById('btn' + mode).classList.add('active');

            if (mode === '2D') map.easeTo({ pitch: 0, bearing: 0, duration: 1000 });
            else map.easeTo({ pitch: 60, bearing: -20, duration: 1000 });
            
            updateBuildingHeight(mode);
        }
    </script>
</body>
</html>